/* all */

/*
steps:
(1) get the business unit of the staffID
(2) query output:
    - staff_id
    - trans_type: 01 or 02
    - count: number of unqiue customers
(3) for each staff_id:
    - count with trans_type=01 - count with trans_type=02 = number of customers
(4) sum up the number of customers and then divide it by the number of staff
*/

SELECT 
	eu.staff_id as staff_id,
	cs.TRANS_TYPE as trans_type,
    COUNT(DISTINCT cs.VIP_NO) as 'count'
FROM CUSTOMER_SALES cs
JOIN ELLC_USERS eu ON eu.staff_id = cs.STAFF_ID
JOIN ELLC_USER_PROFILES eup ON eup.user_id = eu.ID
AND eup.business_unit = 'MW' /* get the business unit before making this query*/
AND cs.ORDER_DATE  >= '2019-01-01' 
AND cs.ORDER_DATE  <= '2023-01-01'
GROUP BY eu.staff_id, cs.TRANS_TYPE

/* clientele */

SELECT 
	eu.staff_id as staff_id,
	cs.TRANS_TYPE as trans_type,
    COUNT(DISTINCT cs.VIP_NO) as 'count'
FROM CUSTOMER_SALES cs
JOIN ELLC_USERS eu ON eu.staff_id = cs.STAFF_ID
JOIN ELLC_USER_PROFILES eup ON eup.user_id = eu.ID
JOIN STAFF_CUSTOMERS sc ON cs.VIP_NO = sc.CUSTOMER_VIP_NO
AND eup.business_unit = 'MW' /* get the business unit before making this query*/
AND cs.ORDER_DATE  >= '2019-01-01' 
AND cs.ORDER_DATE  <= '2023-01-01'
GROUP BY eu.staff_id, cs.TRANS_TYPE

/* nonclientele = all - clientele */
